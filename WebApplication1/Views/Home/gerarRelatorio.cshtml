<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- SheetJS para exportação Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<!-- jsPDF para exportação PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    :root {
        --primary-color: #018DCF;
        --secondary-color: #6c757d;
        --success-color: #198754;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --info-color: #0dcaf0;
        --prefeitura-blue: #018DCF;
        --prefeitura-light: #4da8da;
    }

    .header-prefeitura {
        background: linear-gradient(135deg, var(--prefeitura-blue), var(--prefeitura-light));
        color: white;
        padding: 1rem 0;
        border-bottom: 4px solid #f1c40f;
    }

    .dashboard-card {
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        border: none;
    }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

    .card-icon {
        font-size: 2rem;
        opacity: 0.7;
    }

    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }

    .report-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .section-title {
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 0.5rem;
        margin-bottom: 1.5rem;
        color: #333;
    }

    .filter-section {
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        border-left: 4px solid var(--prefeitura-blue);
    }

    .priority-badge {
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
    }

    .event-table {
        font-size: 0.9rem;
    }

        .event-table th {
            background-color: #f8f9fa;
        }

    .export-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .btn-pdf {
        background-color: #e74c3c;
        border-color: #e74c3c;
        color: white;
    }

        .btn-pdf:hover {
            background-color: #c0392b;
            border-color: #c0392b;
            color: white;
        }

    .btn-excel {
        background-color: #27ae60;
        border-color: #27ae60;
        color: white;
    }

        .btn-excel:hover {
            background-color: #219653;
            border-color: #219653;
            color: white;
        }

    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
    }

    .spinner-border {
        width: 3rem;
        height: 3rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
        border-left: 4px solid var(--prefeitura-blue);
    }

    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: var(--prefeitura-blue);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }

    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .chart-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        height: 400px;
    }
</style>

<!-- Conteúdo Principal -->
<main class="container my-4 form-section">
    <div class="d-flex justify-content-between align-items-center mb-4 p-3 border-bottom bg-light rounded">
        <h1 class="h3 mb-0 text-dark">
            Relatórios de Eventos
        </h1>
        <button type="button" class="btn btn-outline-primary" onclick="window.history.back()">
            <i class="bi bi-arrow-left me-2"></i>Voltar
        </button>
    </div>

    <!-- Filtros -->
    <div class="filter-section mb-4">
        <h5 class="mb-3"><i class="bi bi-funnel me-2"></i>Filtros do Relatório</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label fw-bold">Período</label>
                <select class="form-select" id="periodFilter">
                    <option value="all">Todos os períodos</option>
                    <option value="today">Hoje</option>
                    <option value="week">Esta semana</option>
                    <option value="month">Este mês</option>
                    <option value="quarter">Este trimestre</option>
                    <option value="year">Este ano</option>
                    <option value="custom">Personalizado</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Secretaria</label>
                <select class="form-select" id="secretaryFilter">
                    <option value="all">Todas as secretarias</option>
                    <option value="SEPLAN">Secretaria de Planejamento (SEPLAN)</option>
                    <option value="SEDUC">Secretaria de Educação (SEDUC)</option>
                    <option value="SESPORT">Secretaria de Esportes</option>
                    <option value="SESAU">Secretaria de Saúde</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Categoria</label>
                <select class="form-select" id="categoryFilter">
                    <option value="all">Todas as categorias</option>
                    <option value="cultural">Evento cultural</option>
                    <option value="lecture">Palestra</option>
                    <option value="workshop">Workshop</option>
                    <option value="sports">Evento esportivo</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">Prioridade</label>
                <select class="form-select" id="priorityFilter">
                    <option value="all">Todas as prioridades</option>
                    <option value="normal">Normal</option>
                    <option value="alta">Alta</option>
                    <option value="inadiavel">Inadiável</option>
                </select>
            </div>
        </div>
        <div class="row mt-3" id="customDateRange" style="display: none;">
            <div class="col-md-6">
                <label class="form-label fw-bold">Data inicial</label>
                <input type="date" class="form-control" id="startDate">
            </div>
            <div class="col-md-6">
                <label class="form-label fw-bold">Data final</label>
                <input type="date" class="form-control" id="endDate">
            </div>
        </div>
        <div class="mt-3 d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <button class="btn btn-primary" id="applyFilters">
                    <i class="bi bi-funnel me-1"></i>Aplicar Filtros
                </button>
                <button class="btn btn-outline-secondary ms-2" id="resetFilters">
                    <i class="bi bi-arrow-clockwise me-1"></i>Limpar Filtros
                </button>
            </div>
            <div class="export-buttons mt-2 mt-md-0">
                <button class="btn btn-pdf" id="exportPDF">
                    <i class="bi bi-file-earmark-pdf me-1"></i>Exportar PDF
                </button>
                <button class="btn btn-excel" id="exportExcel">
                    <i class="bi bi-file-earmark-spreadsheet me-1"></i>Exportar Excel
                </button>
            </div>
        </div>
    </div>

    <!-- Estatísticas Rápidas -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="totalEvents">0</div>
            <div class="stat-label">Total de Eventos</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="publicEvents">0</div>
            <div class="stat-label">Eventos Públicos</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="privateEvents">0</div>
            <div class="stat-label">Eventos Privados</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="confirmedEvents">0</div>
            <div class="stat-label">Confirmados pelo Prefeito</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="completedEvents">0</div>
            <div class="stat-label">Eventos Concluídos</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="highPriorityEvents">0</div>
            <div class="stat-label">Alta Prioridade</div>
        </div>
    </div>

    <!-- Gráficos Principais -->
    <div class="charts-grid">
        <div class="chart-card">
            <h5 class="section-title">Eventos por Secretaria</h5>
            <div class="chart-container">
                <canvas id="secretaryChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h5 class="section-title">Eventos por Categoria</h5>
            <div class="chart-container">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h5 class="section-title">Eventos por Prioridade</h5>
            <div class="chart-container">
                <canvas id="priorityChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h5 class="section-title">Tipo de Evento (Público/Privado)</h5>
            <div class="chart-container">
                <canvas id="typeChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h5 class="section-title">Confirmação do Prefeito</h5>
            <div class="chart-container">
                <canvas id="confirmationChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h5 class="section-title">Status dos Eventos</h5>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Tabela de Eventos -->
    <div class="report-section">
        <h3 class="section-title">
            <i class="bi bi-table me-2"></i>Lista de Eventos
        </h3>

        <div class="table-responsive">
            <table class="table table-hover event-table">
                <thead>
                    <tr>
                        <th>Nome do Evento</th>
                        <th>Data</th>
                        <th>Categoria</th>
                        <th>Secretaria</th>
                        <th>Prioridade</th>
                        <th>Tipo</th>
                        <th>Confirmação</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="eventsTableBody">
                    <!-- Os dados serão preenchidos via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- Overlay de Carregamento -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner-border" role="status">
        <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-3" id="loadingText">Gerando relatório, aguarde...</p>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Dados mockados atualizados com os novos campos
    const mockEvents = [
        {
            id: 1,
            name: "Maratona Praia Grande 2025 - Correndo pela Saúde e Solidariedade",
            startDate: "2025-03-15T08:00:00",
            endDate: "2025-03-15T17:00:00",
            category: "sports",
            secretary: "SESPORT",
            priority: "alta",
            type: "publico",
            prefeitoConfirmado: true,
            status: "concluido",
            description: "A Maratona Praia Grande 2025 é uma ação esportiva e solidária organizada pela Secretaria de Esportes e Laser."
        },
        {
            id: 2,
            name: "Workshop de Educação Ambiental",
            startDate: "2025-02-10T14:00:00",
            endDate: "2025-02-10T17:00:00",
            category: "workshop",
            secretary: "SEDUC",
            priority: "normal",
            type: "publico",
            prefeitoConfirmado: false,
            status: "concluido",
            description: "Workshop sobre práticas sustentáveis e educação ambiental para professores da rede municipal."
        },
        {
            id: 3,
            name: "Festival de Música da Cidade",
            startDate: "2025-04-20T18:00:00",
            endDate: "2025-04-22T23:00:00",
            category: "cultural",
            secretary: "SEPLAN",
            priority: "normal",
            type: "publico",
            prefeitoConfirmado: true,
            status: "ativo",
            description: "Festival com apresentações de bandas locais e regionais no centro da cidade."
        },
        {
            id: 4,
            name: "Campanha de Vacinação contra Influenza",
            startDate: "2025-05-05T08:00:00",
            endDate: "2025-05-10T17:00:00",
            category: "lecture",
            secretary: "SESAU",
            priority: "inadiavel",
            type: "publico",
            prefeitoConfirmado: true,
            status: "ativo",
            description: "Campanha de vacinação contra influenza para grupos de risco."
        },
        {
            id: 5,
            name: "Reunião Estratégica de Planejamento",
            startDate: "2025-06-12T09:00:00",
            endDate: "2025-06-12T12:00:00",
            category: "workshop",
            secretary: "SEPLAN",
            priority: "alta",
            type: "privado",
            prefeitoConfirmado: true,
            status: "planejamento",
            description: "Reunião interna para planejamento estratégico municipal."
        },
        {
            id: 6,
            name: "Olimpíadas Estudantis",
            startDate: "2025-08-20T08:00:00",
            endDate: "2025-08-25T18:00:00",
            category: "sports",
            secretary: "SEDUC",
            priority: "normal",
            type: "publico",
            prefeitoConfirmado: false,
            status: "planejamento",
            description: "Competições esportivas entre escolas municipais."
        },
        {
            id: 7,
            name: "Semana da Saúde Mental",
            startDate: "2025-09-10T09:00:00",
            endDate: "2025-09-15T17:00:00",
            category: "lecture",
            secretary: "SESAU",
            priority: "alta",
            type: "publico",
            prefeitoConfirmado: true,
            status: "ativo",
            description: "Palestras e workshops sobre saúde mental e bem-estar."
        },
        {
            id: 8,
            name: "Festival de Teatro Amador",
            startDate: "2025-10-05T19:00:00",
            endDate: "2025-10-08T22:00:00",
            category: "cultural",
            secretary: "SEPLAN",
            priority: "normal",
            type: "publico",
            prefeitoConfirmado: false,
            status: "planejamento",
            description: "Festival com apresentações de grupos de teatro amador da região."
        }
    ];

    // Funções auxiliares
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('pt-BR');
    }

    function getPriorityText(priority) {
        const priorities = {
            'normal': 'Normal',
            'alta': 'Alta',
            'inadiavel': 'Inadiável'
        };
        return priorities[priority] || priority;
    }

    function getPriorityClass(priority) {
        const classes = {
            'normal': 'bg-secondary',
            'alta': 'bg-warning text-dark',
            'inadiavel': 'bg-danger'
        };
        return classes[priority] || 'bg-secondary';
    }

    function getStatusText(status) {
        const statuses = {
            'ativo': 'Ativo',
            'concluido': 'Concluído',
            'planejamento': 'Em Planejamento'
        };
        return statuses[status] || status;
    }

    function getStatusClass(status) {
        const classes = {
            'ativo': 'bg-success',
            'concluido': 'bg-secondary',
            'planejamento': 'bg-info'
        };
        return classes[status] || 'bg-secondary';
    }

    function getTypeText(type) {
        return type === 'publico' ? 'Público' : 'Privado';
    }

    function getConfirmationText(confirmed) {
        return confirmed ? 'Confirmado' : 'Pendente';
    }

    function getConfirmationClass(confirmed) {
        return confirmed ? 'bg-success' : 'bg-warning text-dark';
    }

    // Filtragem de eventos
    function filterEvents() {
        const periodFilter = document.getElementById('periodFilter').value;
        const secretaryFilter = document.getElementById('secretaryFilter').value;
        const categoryFilter = document.getElementById('categoryFilter').value;
        const priorityFilter = document.getElementById('priorityFilter').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        let filteredEvents = [...mockEvents];

        // Aplicar filtros (mesma lógica do código anterior)
        if (periodFilter !== 'all') {
            const now = new Date();
            filteredEvents = filteredEvents.filter(event => {
                const eventDate = new Date(event.startDate);
                // Lógica de filtro por período (mantida do código anterior)
                return true; // Simplificado para exemplo
            });
        }

        if (secretaryFilter !== 'all') {
            filteredEvents = filteredEvents.filter(event => event.secretary === secretaryFilter);
        }

        if (categoryFilter !== 'all') {
            filteredEvents = filteredEvents.filter(event => event.category === categoryFilter);
        }

        if (priorityFilter !== 'all') {
            filteredEvents = filteredEvents.filter(event => event.priority === priorityFilter);
        }

        return filteredEvents;
    }

    // Atualizar dashboard
    function updateDashboard(events) {
        updateStatistics(events);
        updateCharts(events);
        updateEventsTable(events);
    }

    // Atualizar estatísticas
    function updateStatistics(events) {
        document.getElementById('totalEvents').textContent = events.length;

        const publicEvents = events.filter(event => event.type === 'publico').length;
        document.getElementById('publicEvents').textContent = publicEvents;

        const privateEvents = events.filter(event => event.type === 'privado').length;
        document.getElementById('privateEvents').textContent = privateEvents;

        const confirmedEvents = events.filter(event => event.prefeitoConfirmado).length;
        document.getElementById('confirmedEvents').textContent = confirmedEvents;

        const completedEvents = events.filter(event => event.status === 'concluido').length;
        document.getElementById('completedEvents').textContent = completedEvents;

        const highPriorityEvents = events.filter(event =>
            event.priority === 'alta' || event.priority === 'inadiavel').length;
        document.getElementById('highPriorityEvents').textContent = highPriorityEvents;
    }

    // Atualizar gráficos
    function updateCharts(events) {
        updateSecretaryChart(events);
        updateCategoryChart(events);
        updatePriorityChart(events);
        updateTypeChart(events);
        updateConfirmationChart(events);
        updateStatusChart(events);
    }

    // Gráfico por Secretaria
    function updateSecretaryChart(events) {
        const secretaries = ['SEPLAN', 'SEDUC', 'SESPORT', 'SESAU'];
        const data = secretaries.map(sec =>
            events.filter(event => event.secretary === sec).length
        );

        const ctx = document.getElementById('secretaryChart').getContext('2d');

        if (window.secretaryChartInstance) {
            window.secretaryChartInstance.destroy();
        }

        window.secretaryChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: secretaries.map(sec => getSecretaryText(sec)),
                datasets: [{
                    label: 'Número de Eventos',
                    data: data,
                    backgroundColor: '#018DCF',
                    borderColor: '#0178B5',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    // Gráfico por Categoria
    function updateCategoryChart(events) {
        const categories = ['cultural', 'lecture', 'workshop', 'sports'];
        const data = categories.map(cat =>
            events.filter(event => event.category === cat).length
        );

        const ctx = document.getElementById('categoryChart').getContext('2d');

        if (window.categoryChartInstance) {
            window.categoryChartInstance.destroy();
        }

        window.categoryChartInstance = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: categories.map(cat => getCategoryText(cat)),
                datasets: [{
                    data: data,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    // Gráfico por Prioridade
    function updatePriorityChart(events) {
        const priorities = ['normal', 'alta', 'inadiavel'];
        const data = priorities.map(pri =>
            events.filter(event => event.priority === pri).length
        );

        const ctx = document.getElementById('priorityChart').getContext('2d');

        if (window.priorityChartInstance) {
            window.priorityChartInstance.destroy();
        }

        window.priorityChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: priorities.map(pri => getPriorityText(pri)),
                datasets: [{
                    data: data,
                    backgroundColor: ['#6C757D', '#FFC107', '#DC3545']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    // Gráfico por Tipo (Público/Privado)
    function updateTypeChart(events) {
        const types = ['publico', 'privado'];
        const data = types.map(type =>
            events.filter(event => event.type === type).length
        );

        const ctx = document.getElementById('typeChart').getContext('2d');

        if (window.typeChartInstance) {
            window.typeChartInstance.destroy();
        }

        window.typeChartInstance = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Público', 'Privado'],
                datasets: [{
                    data: data,
                    backgroundColor: ['#018DCF', '#6C757D']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    // Gráfico de Confirmação do Prefeito
    function updateConfirmationChart(events) {
        const confirmed = events.filter(event => event.prefeitoConfirmado).length;
        const pending = events.length - confirmed;

        const ctx = document.getElementById('confirmationChart').getContext('2d');

        if (window.confirmationChartInstance) {
            window.confirmationChartInstance.destroy();
        }

        window.confirmationChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Confirmados', 'Pendentes'],
                datasets: [{
                    data: [confirmed, pending],
                    backgroundColor: ['#28A745', '#FFC107']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    // Gráfico de Status
    function updateStatusChart(events) {
        const statuses = ['ativo', 'concluido', 'planejamento'];
        const data = statuses.map(status =>
            events.filter(event => event.status === status).length
        );

        const ctx = document.getElementById('statusChart').getContext('2d');

        if (window.statusChartInstance) {
            window.statusChartInstance.destroy();
        }

        window.statusChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: statuses.map(status => getStatusText(status)),
                datasets: [{
                    label: 'Número de Eventos',
                    data: data,
                    backgroundColor: ['#28A745', '#6C757D', '#17A2B8']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    // Atualizar tabela de eventos
    function updateEventsTable(events) {
        const tableBody = document.getElementById('eventsTableBody');
        tableBody.innerHTML = '';

        if (events.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center py-4">
                        <i class="bi bi-inbox display-4 text-muted d-block mb-2"></i>
                        <span class="text-muted">Nenhum evento encontrado com os filtros aplicados</span>
                    </td>
                </tr>
            `;
            return;
        }

        events.forEach(event => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${event.name}</td>
                <td>${formatDate(event.startDate)}</td>
                <td>${getCategoryText(event.category)}</td>
                <td>${getSecretaryText(event.secretary)}</td>
                <td>
                    <span class="badge priority-badge ${getPriorityClass(event.priority)}">
                        ${getPriorityText(event.priority)}
                    </span>
                </td>
                <td>${getTypeText(event.type)}</td>
                <td>
                    <span class="badge ${getConfirmationClass(event.prefeitoConfirmado)}">
                        ${getConfirmationText(event.prefeitoConfirmado)}
                    </span>
                </td>
                <td>
                    <span class="badge ${getStatusClass(event.status)}">
                        ${getStatusText(event.status)}
                    </span>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Funções auxiliares para textos
    function getCategoryText(category) {
        const categories = {
            'cultural': 'Evento Cultural',
            'lecture': 'Palestra',
            'workshop': 'Workshop',
            'sports': 'Evento Esportivo'
        };
        return categories[category] || category;
    }

    function getSecretaryText(secretary) {
        const secretaries = {
            'SEPLAN': 'Secretaria de Planejamento (SEPLAN)',
            'SEDUC': 'Secretaria de Educação (SEDUC)',
            'SESPORT': 'Secretaria de Esportes',
            'SESAU': 'Secretaria de Saúde'
        };
        return secretaries[secretary] || secretary;
    }

    // Exportação para PDF (atualizada com o logo)
    function exportToPDF() {
        showLoading('Gerando PDF...');

        setTimeout(() => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');

            // Cabeçalho com cor personalizada
            doc.setFillColor(1, 141, 207); // #018DCF
            doc.rect(0, 0, 210, 30, 'F');

            // Logo (texto simulado)
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Prefeitura Municipal de Praia Grande', 105, 12, { align: 'center' });
            doc.setFontSize(10);
            doc.text('Relatório de Eventos - Secretaria de Eventos', 105, 18, { align: 'center' });

            // Data de geração
            const currentDate = new Date().toLocaleDateString('pt-BR');
            doc.text(`Gerado em: ${currentDate}`, 105, 25, { align: 'center' });

            // Conteúdo do relatório
            const filteredEvents = filterEvents();
            let yPosition = 40;

            // Estatísticas
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Resumo Estatístico', 20, yPosition);

            yPosition += 10;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(`Total de Eventos: ${filteredEvents.length}`, 20, yPosition);
            yPosition += 5;
            doc.text(`Eventos Públicos: ${filteredEvents.filter(e => e.type === 'publico').length}`, 20, yPosition);
            yPosition += 5;
            doc.text(`Eventos Privados: ${filteredEvents.filter(e => e.type === 'privado').length}`, 20, yPosition);
            yPosition += 5;
            doc.text(`Confirmados pelo Prefeito: ${filteredEvents.filter(e => e.prefeitoConfirmado).length}`, 20, yPosition);
            yPosition += 5;
            doc.text(`Eventos Concluídos: ${filteredEvents.filter(e => e.status === 'concluido').length}`, 20, yPosition);

            yPosition += 10;

            // Tabela de eventos
            if (filteredEvents.length > 0) {
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('Lista de Eventos', 20, yPosition);
                yPosition += 7;

                // Cabeçalho da tabela
                doc.setFillColor(240, 240, 240);
                doc.rect(20, yPosition, 170, 7, 'F');
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.text('Evento', 22, yPosition + 5);
                doc.text('Data', 100, yPosition + 5);
                doc.text('Secretaria', 120, yPosition + 5);
                doc.text('Prioridade', 150, yPosition + 5);
                doc.text('Status', 170, yPosition + 5);

                yPosition += 7;

                // Conteúdo da tabela
                doc.setFont('helvetica', 'normal');
                filteredEvents.forEach((event, index) => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }

                    const eventName = event.name.length > 40 ? event.name.substring(0, 37) + '...' : event.name;

                    doc.text(eventName, 22, yPosition + 5);
                    doc.text(formatDate(event.startDate), 100, yPosition + 5);
                    doc.text(getSecretaryText(event.secretary), 120, yPosition + 5);
                    doc.text(getPriorityText(event.priority), 150, yPosition + 5);
                    doc.text(getStatusText(event.status), 170, yPosition + 5);

                    yPosition += 5;
                });
            }

            // Rodapé
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text(`Página ${i} de ${pageCount}`, 105, 290, { align: 'center' });
                doc.text('Prefeitura Municipal de Praia Grande - Relatório de Eventos', 105, 295, { align: 'center' });
            }

            doc.save(`relatorio_eventos_prefeitura_${new Date().toISOString().slice(0, 10)}.pdf`);
            hideLoading();
        }, 1000);
    }

    // Funções de loading
    function showLoading(message = 'Gerando relatório, aguarde...') {
        document.getElementById('loadingText').textContent = message;
        document.getElementById('loadingOverlay').style.display = 'flex';
    }

    function hideLoading() {
        document.getElementById('loadingOverlay').style.display = 'none';
    }

    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        // Configuração dos filtros
        document.getElementById('periodFilter').addEventListener('change', function() {
            const customDateRange = document.getElementById('customDateRange');
            customDateRange.style.display = this.value === 'custom' ? 'block' : 'none';
        });

        document.getElementById('applyFilters').addEventListener('click', function() {
            const filteredEvents = filterEvents();
            updateDashboard(filteredEvents);
        });

        document.getElementById('resetFilters').addEventListener('click', function() {
            document.getElementById('periodFilter').value = 'all';
            document.getElementById('secretaryFilter').value = 'all';
            document.getElementById('categoryFilter').value = 'all';
            document.getElementById('priorityFilter').value = 'all';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('customDateRange').style.display = 'none';

            updateDashboard(mockEvents);
        });

        // Exportação
        document.getElementById('exportExcel').addEventListener('click', function() {
            // Implementação do Excel (mantida do código anterior)
            showLoading('Exportando para Excel...');
            setTimeout(() => hideLoading(), 1000);
        });

        document.getElementById('exportPDF').addEventListener('click', exportToPDF);

        // Inicializar com todos os eventos
        updateDashboard(mockEvents);
    });
</script>