<body class="min-h-screen">
    <div id="app" class="flex">

        <!-- Conteúdo Principal do Dashboard -->
        <main class="flex-1 p-3 sm:p-4 md:p-6 lg:p-8">
            <!-- Título Principal -->
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-gray-800 mb-4 sm:mb-6">Visão Geral dos Eventos</h1>

            <!-- Cards de Estatísticas (Metrics) - Responsivo -->
            <div id="metrics-container" class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 mb-6 sm:mb-8 md:mb-10">
                <!-- Total de Eventos -->
                <div class="stat-card bg-white p-4 sm:p-5 md:p-6 rounded-xl shadow-md border-b-4 border-indigo-500">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-500 font-medium text-sm sm:text-base">Total de Eventos</span>
                        <i class="bi bi-calendar-check text-xl sm:text-2xl text-indigo-500"></i>
                    </div>
                    <p id="totalEvents" class="text-2xl sm:text-3xl md:text-4xl font-bold mt-2 text-gray-900">0</p>
                </div>
                <!-- Prioridade Inadiável -->
                <div class="stat-card bg-white p-4 sm:p-5 md:p-6 rounded-xl shadow-md border-b-4 border-red-500">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-500 font-medium text-sm sm:text-base">Prioridade Inadiável</span>
                        <i class="bi bi-fire text-xl sm:text-2xl text-red-500"></i>
                    </div>
                    <p id="inadiavelPriority" class="text-2xl sm:text-3xl md:text-4xl font-bold mt-2 text-gray-900">0</p>
                </div>
                <!-- Eventos Públicos -->
                <div class="stat-card bg-white p-4 sm:p-5 md:p-6 rounded-xl shadow-md border-b-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-500 font-medium text-sm sm:text-base">Eventos Públicos</span>
                        <i class="bi bi-globe text-xl sm:text-2xl text-green-500"></i>
                    </div>
                    <p id="publicEvents" class="text-2xl sm:text-3xl md:text-4xl font-bold mt-2 text-gray-900">0</p>
                </div>
                <!-- Próximo Evento -->
                <div class="stat-card bg-white p-4 sm:p-5 md:p-6 rounded-xl shadow-md border-b-4 border-yellow-500">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-500 font-medium text-sm sm:text-base">Próximo Início</span>
                        <i class="bi bi-clock text-xl sm:text-2xl text-yellow-500"></i>
                    </div>
                    <p id="nextEventDate" class="text-base sm:text-lg md:text-xl font-bold mt-2 text-gray-900 break-words">Buscando...</p>
                </div>
            </div>

            <!-- Filtros e Controles de Visualização - Responsivo -->
            <div class="bg-white p-4 sm:p-5 md:p-6 rounded-xl shadow-lg mb-4 sm:mb-5 md:mb-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4">
                    <h2 class="text-xl sm:text-2xl font-semibold text-gray-800">Filtros</h2>

                    <!-- Botões de Visualização -->
                    <div class="flex gap-2 self-end sm:self-auto">
                        <button id="viewListBtn" class="px-3 py-2 sm:px-4 sm:py-2 bg-indigo-600 text-white rounded-lg flex items-center gap-2 text-sm sm:text-base">
                            <i class="bi bi-list-ul"></i>
                            <span class="hidden xs:inline">Lista</span>
                        </button>
                        <button id="viewCalendarBtn" class="px-3 py-2 sm:px-4 sm:py-2 bg-gray-200 text-gray-700 rounded-lg flex items-center gap-2 text-sm sm:text-base">
                            <i class="bi bi-calendar-week"></i>
                            <span class="hidden xs:inline">Calendário</span>
                        </button>
                    </div>
                </div>

                <!-- Filtros em Grid Responsivo -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mt-3 sm:mt-4">
                    <!-- Filtro por Secretaria -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Secretaria</label>
                        <select id="secretariaFilter" class="w-full p-2 text-sm sm:text-base border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Todas as Secretarias</option>
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>

                    <!-- Filtro por Categoria -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                        <select id="categoriaFilter" class="w-full p-2 text-sm sm:text-base border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Todas as Categorias</option>
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>

                    <!-- Filtro por Prioridade -->
                    <div class="sm:col-span-2 lg:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Prioridade</label>
                        <select id="prioridadeFilter" class="w-full p-2 text-sm sm:text-base border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Todas as Prioridades</option>
                            <option value="inadiável">Inadiável</option>
                            <option value="alta">Alta</option>
                            <option value="normal">Normal</option>
                        </select>
                    </div>
                </div>

                <!-- Botão Limpar Filtros -->
                <div class="mt-3 sm:mt-4 flex justify-end">
                    <button id="clearFiltersBtn" class="px-3 py-2 sm:px-4 sm:py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm sm:text-base">
                        Limpar Filtros
                    </button>
                </div>
            </div>

            <!-- Container para Visualização de Lista - Responsivo -->
            <div id="listView" class="bg-white p-4 sm:p-5 md:p-6 rounded-xl shadow-lg">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0 mb-3 sm:mb-4 border-b pb-3">
                    <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-2 sm:mb-0">Lista de Eventos</h2>
                    <span class="text-xs sm:text-sm text-gray-500" id="lastUpdate"></span>
                </div>

                <div class="overflow-x-auto -mx-2 sm:mx-0">
                    <div class="min-w-full inline-block align-middle">
                        <table class="min-w-full divide-y divide-gray-200 text-sm sm:text-base">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-2 sm:px-3 md:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Evento</th>
                                    <th class="px-2 sm:px-3 md:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Prioridade</th>
                                    <th class="px-2 sm:px-3 md:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                    <th class="px-2 sm:px-3 md:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">Local</th>
                                    <th class="px-2 sm:px-3 md:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTableBody" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="5" class="px-2 sm:px-4 py-4 text-sm text-gray-500 text-center">Carregando eventos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Indicador de carregamento/erro -->
                <div id="loadingIndicator" class="text-center py-4 hidden">
                    <i class="bi bi-arrow-clockwise animate-spin text-indigo-500 text-2xl sm:text-3xl"></i>
                    <p class="text-gray-500 mt-2 text-sm sm:text-base">Buscando dados...</p>
                </div>
            </div>

            <!-- Container para Visualização de Calendário - Responsivo -->
            <div id="calendarView" class="bg-white p-4 sm:p-5 md:p-6 rounded-xl shadow-lg hidden">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0 mb-3 sm:mb-4 border-b pb-3">
                    <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-2 sm:mb-0">Calendário</h2>
                    <div class="flex items-center gap-2 sm:gap-4 self-end sm:self-auto">
                        <button id="prevMonthBtn" class="p-1 sm:p-2 rounded-full hover:bg-gray-100 text-lg sm:text-xl">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <span id="currentMonthYear" class="text-base sm:text-lg font-medium whitespace-nowrap">Carregando...</span>
                        <button id="nextMonthBtn" class="p-1 sm:p-2 rounded-full hover:bg-gray-100 text-lg sm:text-xl">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Cabeçalho dos dias da semana - Responsivo -->
                <div class="grid grid-cols-7 gap-1 mb-2">
                    <div class="text-center font-medium text-gray-500 py-1 sm:py-2 text-xs sm:text-sm">Dom</div>
                    <div class="text-center font-medium text-gray-500 py-1 sm:py-2 text-xs sm:text-sm">Seg</div>
                    <div class="text-center font-medium text-gray-500 py-1 sm:py-2 text-xs sm:text-sm">Ter</div>
                    <div class="text-center font-medium text-gray-500 py-1 sm:py-2 text-xs sm:text-sm">Qua</div>
                    <div class="text-center font-medium text-gray-500 py-1 sm:py-2 text-xs sm:text-sm">Qui</div>
                    <div class="text-center font-medium text-gray-500 py-1 sm:py-2 text-xs sm:text-sm">Sex</div>
                    <div class="text-center font-medium text-gray-500 py-1 sm:py-2 text-xs sm:text-sm">Sáb</div>
                </div>

                <!-- Grade do calendário - Responsivo -->
                <div id="calendarGrid" class="grid grid-cols-7 gap-1 min-h-[400px] sm:min-h-[500px]">
                    <!-- Os dias serão preenchidos dinamicamente -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Detalhes do Evento - Responsivo -->
    <div id="eventDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-3 md:p-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-xs sm:max-w-md md:max-w-2xl max-h-[85vh] sm:max-h-[90vh] overflow-y-auto mx-2">
            <div class="flex justify-between items-center p-4 sm:p-5 md:p-6 border-b">
                <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-gray-800 pr-2" id="modalEventTitle">Detalhes do Evento</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 text-xl sm:text-2xl flex-shrink-0">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="p-4 sm:p-5 md:p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-5 md:gap-6">
                    <div>
                        <h4 class="text-base sm:text-lg font-semibold text-gray-700 mb-3 sm:mb-4">Informações Básicas</h4>
                        <div class="space-y-2 sm:space-y-3">
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Nome do Evento</label>
                                <p id="modalEventName" class="text-gray-900 font-medium text-sm sm:text-base break-words">-</p>
                            </div>
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Descrição</label>
                                <p id="modalEventDescription" class="text-gray-900 text-sm sm:text-base break-words">-</p>
                            </div>
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Categoria</label>
                                <p id="modalEventCategory" class="text-gray-900 text-sm sm:text-base">-</p>
                            </div>
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Secretaria</label>
                                <p id="modalEventSecretaria" class="text-gray-900 text-sm sm:text-base">-</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-base sm:text-lg font-semibold text-gray-700 mb-3 sm:mb-4">Datas e Local</h4>
                        <div class="space-y-2 sm:space-y-3">
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Data e Hora de Início</label>
                                <p id="modalEventStart" class="text-gray-900 text-sm sm:text-base">-</p>
                            </div>
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Data e Hora de Término</label>
                                <p id="modalEventEnd" class="text-gray-900 text-sm sm:text-base">-</p>
                            </div>
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Localização</label>
                                <p id="modalEventLocation" class="text-gray-900 text-sm sm:text-base break-words">-</p>
                            </div>
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-500">Endereço</label>
                                <p id="modalEventAddress" class="text-gray-900 text-sm sm:text-base break-words">-</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 sm:mt-5 md:mt-6 pt-4 sm:pt-5 md:pt-6 border-t">
                    <h4 class="text-base sm:text-lg font-semibold text-gray-700 mb-3 sm:mb-4">Configurações</h4>
                    <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-500">Prioridade</label>
                            <p id="modalEventPriority" class="text-gray-900 text-sm sm:text-base">-</p>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-500">Tipo</label>
                            <p id="modalEventType" class="text-gray-900 text-sm sm:text-base">-</p>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-500">Status</label>
                            <p id="modalEventStatus" class="text-gray-900 text-sm sm:text-base">-</p>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-500">Participantes</label>
                            <p id="modalEventParticipants" class="text-gray-900 text-sm sm:text-base">-</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 p-4 sm:p-5 md:p-6 border-t bg-gray-50 rounded-b-xl">
                <button id="closeModalBtn2" class="px-3 py-2 sm:px-4 sm:py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-sm sm:text-base order-2 sm:order-1">
                    Fechar
                </button>
                <button id="editFromModalBtn" class="px-3 py-2 sm:px-4 sm:py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2 text-sm sm:text-base order-1 sm:order-2 mb-2 sm:mb-0">
                    <i class="bi bi-pencil"></i>
                    Editar Evento
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, onSnapshot, getDoc, doc, setDoc, updateDoc, deleteDoc, getDocs, orderBy, where, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variáveis globais
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let userId = null;
        let unsubscribeEvents = null;
        let allEvents = []; // Armazena todos os eventos para filtragem
        let currentView = 'list'; // 'list' ou 'calendar'
        let currentDate = new Date(); // Data atual para o calendário
        let currentEventId = null; // ID do evento atualmente sendo visualizado

        // Configurações do DOM
        const totalEventsEl = document.getElementById('totalEvents');
        const inadiavelPriorityEl = document.getElementById('inadiavelPriority');
        const publicEventsEl = document.getElementById('publicEvents');
        const nextEventDateEl = document.getElementById('nextEventDate');
        const eventsTableBody = document.getElementById('eventsTableBody');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const lastUpdateEl = document.getElementById('lastUpdate');

        // Novos elementos para filtros e visualização
        const listView = document.getElementById('listView');
        const calendarView = document.getElementById('calendarView');
        const viewListBtn = document.getElementById('viewListBtn');
        const viewCalendarBtn = document.getElementById('viewCalendarBtn');
        const secretariaFilter = document.getElementById('secretariaFilter');
        const categoriaFilter = document.getElementById('categoriaFilter');
        const prioridadeFilter = document.getElementById('prioridadeFilter');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');
        const calendarGrid = document.getElementById('calendarGrid');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');

        // Elementos do modal
        const eventDetailsModal = document.getElementById('eventDetailsModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const closeModalBtn2 = document.getElementById('closeModalBtn2');
        const editFromModalBtn = document.getElementById('editFromModalBtn');

        // Dados mockados para demonstração
        function generateMockEvents() {
            const mockEvents = [];

            // Listas separadas para categorias e secretarias
            const categories = [
                'Workshop',
                'Apresentação',
                'Seminário',
                'Treinamento',
                'Conferência',
                'Reunião',
                'Fórum',
                'Capacitação'
            ];

            const secretarias = [
                'Secretaria de Educação',
                'Secretaria de Saúde',
                'Secretaria de Planejamento',
                'Secretaria de Administração',
                'Secretaria de Finanças',
                'Secretaria de Obras',
                'Secretaria de Meio Ambiente',
                'Secretaria de Cultura'
            ];

            const priorities = ['inadiável', 'alta', 'normal'];
            const eventTypes = ['publico', 'privado'];
            const statuses = ['confirmado', 'pendente', 'cancelado'];

            const eventNames = [
                'Reunião de Planejamento Anual',
                'Workshop de Inovação Tecnológica',
                'Cerimônia de Premiação',
                'Treinamento de Liderança',
                'Fórum de Desenvolvimento Sustentável',
                'Conferência Municipal de Educação',
                'Seminário de Gestão Pública',
                'Encontro de Integração de Equipes',
                'Auditória Interna',
                'Capacitação em Gestão de Projetos'
            ];

            const locations = [
                'Auditório Principal - Prefeitura',
                'Sala de Reuniões 1 - SEPLAN',
                'Centro de Convenções Municipal',
                'SEDUC - Sala de Treinamentos',
                'Parque Municipal - Área de Eventos',
                'Teatro Municipal',
                'SEAD - Auditório 2B',
                'Biblioteca Pública Municipal'
            ];

            const baseDate = new Date();

            for (let i = 0; i < 15; i++) {
                const startDate = new Date(baseDate);
                startDate.setDate(startDate.getDate() + Math.floor(Math.random() * 30));
                startDate.setHours(8 + Math.floor(Math.random() * 8), 0, 0, 0);

                const endDate = new Date(startDate);
                endDate.setHours(startDate.getHours() + 2 + Math.floor(Math.random() * 6));

                const event = {
                    id: `mock-event-${i + 1}`,
                    nomeEvento: eventNames[Math.floor(Math.random() * eventNames.length)],
                    descricao: `Descrição detalhada do evento ${i + 1}. Este é um evento importante que requer atenção especial.`,
                    categoria: categories[Math.floor(Math.random() * categories.length)],
                    secretaria: secretarias[Math.floor(Math.random() * secretarias.length)],
                    dataHoraInicio: {
                        toDate: () => startDate,
                        seconds: Math.floor(startDate.getTime() / 1000)
                    },
                    dataHoraTermino: {
                        toDate: () => endDate,
                        seconds: Math.floor(endDate.getTime() / 1000)
                    },
                    localizacao: locations[Math.floor(Math.random() * locations.length)],
                    endereco: `Rua Exemplo, ${Math.floor(Math.random() * 1000) + 1}, Centro, Cidade - Estado`,
                    prioridade: priorities[Math.floor(Math.random() * priorities.length)],
                    tipoEvento: eventTypes[Math.floor(Math.random() * eventTypes.length)],
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    participantesEstimados: Math.floor(Math.random() * 200) + 50,
                    criadoPor: 'sistema',
                    dataCriacao: {
                        toDate: () => new Date(baseDate.getTime() - Math.floor(Math.random() * 7) * 24 * 60 * 60 * 1000),
                        seconds: Math.floor((baseDate.getTime() - Math.floor(Math.random() * 7) * 24 * 60 * 60 * 1000) / 1000)
                    }
                };

                mockEvents.push(event);
            }

            return mockEvents;
        }

        // Função utilitária para formatar data e hora
        function formatDate(timestamp) {
            if (!timestamp || !timestamp.toDate) return 'N/A';
            const date = timestamp.toDate();
            return date.toLocaleDateString('pt-BR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Função para determinar a cor da prioridade
        function getPriorityColor(priority) {
            switch (priority ? priority.toLowerCase() : '') {
                case 'inadiável':
                    return 'bg-red-100 text-red-800';
                case 'alta':
                    return 'bg-purple-100 text-purple-800';
                case 'normal':
                default:
                    return 'bg-blue-100 text-blue-800';
            }
        }

        // Função para navegar para a página de edição
        function navigateToEditEvent(eventId) {
            window.location.href = `criar-evento.html?edit=${eventId}`;
        }

        // Função para excluir evento
        async function deleteEvent(eventId, eventName) {
            if (!confirm(`Tem certeza que deseja excluir o evento "${eventName}"?`)) {
                return;
            }

            try {
                const eventDocRef = doc(db, `artifacts/${appId}/public/data/events`, eventId);
                await deleteDoc(eventDocRef);

                // Mostra mensagem de sucesso
                showNotification('Evento excluído com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao excluir evento:', error);
                showNotification('Erro ao excluir evento.', 'error');
            }
        }

        // Função para mostrar notificações
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Função para mostrar detalhes do evento
        function showEventDetails(event) {
            currentEventId = event.id;

            // Preenche os dados do modal
            document.getElementById('modalEventTitle').textContent = event.nomeEvento || 'Detalhes do Evento';
            document.getElementById('modalEventName').textContent = event.nomeEvento || 'Não informado';
            document.getElementById('modalEventDescription').textContent = event.descricao || 'Não informado';
            document.getElementById('modalEventCategory').textContent = event.categoria || 'Não informado';
            document.getElementById('modalEventSecretaria').textContent = event.secretaria || 'Não informado';
            document.getElementById('modalEventStart').textContent = formatDate(event.dataHoraInicio);
            document.getElementById('modalEventEnd').textContent = formatDate(event.dataHoraTermino);
            document.getElementById('modalEventLocation').textContent = event.localizacao || 'Não informado';
            document.getElementById('modalEventAddress').textContent = event.endereco || 'Não informado';
            document.getElementById('modalEventPriority').textContent = event.prioridade || 'Normal';
            document.getElementById('modalEventType').textContent = event.tipoEvento === 'publico' ? 'Público' : 'Privado';
            document.getElementById('modalEventStatus').textContent = event.status || 'Não informado';
            document.getElementById('modalEventParticipants').textContent = event.participantesEstimados ? `${event.participantesEstimados} participantes` : 'Não informado';

            // Mostra o modal
            eventDetailsModal.classList.remove('hidden');
        }

        // Função para fechar o modal
        function closeEventDetails() {
            eventDetailsModal.classList.add('hidden');
            currentEventId = null;
        }

        // Função para aplicar filtros
        function applyFilters() {
            const secretariaValue = secretariaFilter.value;
            const categoriaValue = categoriaFilter.value;
            const prioridadeValue = prioridadeFilter.value;

            let filteredEvents = [...allEvents];

            // Aplica filtros
            if (secretariaValue) {
                filteredEvents = filteredEvents.filter(event =>
                    event.secretaria && event.secretaria.toLowerCase() === secretariaValue.toLowerCase()
                );
            }

            if (categoriaValue) {
                filteredEvents = filteredEvents.filter(event =>
                    event.categoria && event.categoria.toLowerCase() === categoriaValue.toLowerCase()
                );
            }

            if (prioridadeValue) {
                filteredEvents = filteredEvents.filter(event =>
                    event.prioridade && event.prioridade.toLowerCase() === prioridadeValue.toLowerCase()
                );
            }

            // Renderiza os eventos filtrados
            if (currentView === 'list') {
                renderEvents(filteredEvents);
            } else {
                renderCalendar(currentDate, filteredEvents);
            }
        }

        // Função para preencher opções de filtro
        function populateFilterOptions(events) {
            // Limpa opções existentes (exceto a primeira)
            while (secretariaFilter.children.length > 1) {
                secretariaFilter.removeChild(secretariaFilter.lastChild);
            }
            while (categoriaFilter.children.length > 1) {
                categoriaFilter.removeChild(categoriaFilter.lastChild);
            }

            // Coleta valores únicos para secretarias e categorias
            const secretarias = [...new Set(events.map(event => event.secretaria).filter(Boolean))];
            const categorias = [...new Set(events.map(event => event.categoria).filter(Boolean))];

            // Adiciona opções de secretaria
            secretarias.forEach(secretaria => {
                const option = document.createElement('option');
                option.value = secretaria;
                option.textContent = secretaria;
                secretariaFilter.appendChild(option);
            });

            // Adiciona opções de categoria
            categorias.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                categoriaFilter.appendChild(option);
            });
        }

        // Função para alternar entre visualizações
        function toggleView(view) {
            currentView = view;

            if (view === 'list') {
                listView.classList.remove('hidden');
                calendarView.classList.add('hidden');
                viewListBtn.classList.add('bg-indigo-600', 'text-white');
                viewListBtn.classList.remove('bg-gray-200', 'text-gray-700');
                viewCalendarBtn.classList.add('bg-gray-200', 'text-gray-700');
                viewCalendarBtn.classList.remove('bg-indigo-600', 'text-white');
                renderEvents(allEvents);
            } else {
                listView.classList.add('hidden');
                calendarView.classList.remove('hidden');
                viewCalendarBtn.classList.add('bg-indigo-600', 'text-white');
                viewCalendarBtn.classList.remove('bg-gray-200', 'text-gray-700');
                viewListBtn.classList.add('bg-gray-200', 'text-gray-700');
                viewListBtn.classList.remove('bg-indigo-600', 'text-white');
                renderCalendar(currentDate, allEvents);
            }
        }

        // Função para renderizar o calendário
        function renderCalendar(date, events) {
            const year = date.getFullYear();
            const month = date.getMonth();

            // Atualiza o cabeçalho do mês/ano
            const monthNames = [
                'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            currentMonthYear.textContent = `${monthNames[month]} ${year}`;

            // Limpa o grid do calendário
            calendarGrid.innerHTML = '';

            // Primeiro dia do mês
            const firstDay = new Date(year, month, 1);
            // Último dia do mês
            const lastDay = new Date(year, month + 1, 0);
            // Dia da semana do primeiro dia (0 = Domingo, 1 = Segunda, etc.)
            const firstDayOfWeek = firstDay.getDay();

            // Adiciona células vazias para os dias antes do primeiro dia do mês
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'h-24 bg-gray-50 rounded';
                calendarGrid.appendChild(emptyCell);
            }

            // Adiciona os dias do mês
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'h-24 border border-gray-200 p-1 overflow-y-auto';

                // Data atual sendo renderizada
                const currentDate = new Date(year, month, day);

                // Verifica se é hoje
                const today = new Date();
                if (currentDate.toDateString() === today.toDateString()) {
                    dayCell.classList.add('bg-blue-50');
                }

                // Cabeçalho do dia
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-right font-medium mb-1';
                dayHeader.textContent = day;
                dayCell.appendChild(dayHeader);

                // Eventos para este dia
                const dayEvents = events.filter(event => {
                    if (!event.dataHoraInicio || !event.dataHoraInicio.toDate) return false;

                    const eventDate = event.dataHoraInicio.toDate();
                    return eventDate.getDate() === day &&
                           eventDate.getMonth() === month &&
                           eventDate.getFullYear() === year;
                });

                // Adiciona eventos ao dia
                dayEvents.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = `text-xs p-1 mb-1 rounded truncate cursor-pointer ${getPriorityColor(event.prioridade)}`;
                    eventElement.textContent = event.nomeEvento || 'Evento sem nome';
                    eventElement.title = `${event.nomeEvento || 'Evento sem nome'} - ${formatDate(event.dataHoraInicio)}`;
                    eventElement.addEventListener('click', () => showEventDetails(event));
                    dayCell.appendChild(eventElement);
                });

                calendarGrid.appendChild(dayCell);
            }
        }

        // Função para renderizar a tabela
        function renderEvents(events) {
            eventsTableBody.innerHTML = '';

            if (events.length === 0) {
                eventsTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-4 py-4 text-sm text-gray-500 text-center">
                            Nenhum evento cadastrado.
                            <a href="criar-evento.cshtml" class="text-indigo-600 hover:text-indigo-800 ml-1">
                                Crie o primeiro evento!
                            </a>
                        </td>
                    </tr>
                `;
                return;
            }

            // Ordena os eventos pela data de início (mais recentes primeiro)
            events.sort((a, b) => (b.dataHoraInicio?.seconds || 0) - (a.dataHoraInicio?.seconds || 0));

            // Atualiza as métricas
            totalEventsEl.textContent = events.length;
            inadiavelPriorityEl.textContent = events.filter(e => e.prioridade && e.prioridade.toLowerCase() === 'inadiável').length;
            publicEventsEl.textContent = events.filter(e => e.tipoEvento && e.tipoEvento.toLowerCase() === 'publico').length;

            // Próximo evento (o mais próximo no futuro)
            const now = new Date();
            const futureEvents = events
                .filter(event => event.dataHoraInicio && event.dataHoraInicio.toDate() > now)
                .sort((a, b) => (a.dataHoraInicio.seconds || 0) - (b.dataHoraInicio.seconds || 0));

            nextEventDateEl.textContent = futureEvents[0] ? formatDate(futureEvents[0].dataHoraInicio) : 'Nenhum evento futuro';

            // Atualiza o timestamp da última atualização
            lastUpdateEl.textContent = `Atualizado em ${new Date().toLocaleTimeString('pt-BR')}`;

            // Renderiza as linhas da tabela
            events.forEach(event => {
                const priorityClass = getPriorityColor(event.prioridade);
                const startDate = event.dataHoraInicio ? formatDate(event.dataHoraInicio) : 'N/A';
                const isPastEvent = event.dataHoraInicio && event.dataHoraInicio.toDate() < new Date();

                const row = document.createElement('tr');
                row.className = `hover:bg-gray-50 ${isPastEvent ? 'opacity-60' : ''}`;
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm font-medium text-gray-900">
                        ${event.nomeEvento || 'Sem Nome'}
                        ${isPastEvent ? '<span class="ml-2 text-xs text-gray-500">(Realizado)</span>' : ''}
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${priorityClass}">
                            ${event.prioridade || 'Normal'}
                        </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${startDate}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">${event.endereco || 'Local Não Informado'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                        <button onclick="showEventDetails(${JSON.stringify(event).replace(/"/g, '&quot;')})" class="text-blue-600 hover:text-blue-900 mr-3" title="Visualizar Detalhes">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button onclick="navigateToEditEvent('${event.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3" title="Editar">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button onclick="deleteEvent('${event.id}', '${(event.nomeEvento || 'Evento').replace(/'/g, "\\'")}')" class="text-red-600 hover:text-red-900" title="Excluir">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                eventsTableBody.appendChild(row);
            });
        }

        // Função para escutar a coleção de eventos
        function subscribeToEvents() {
            if (!db) return;

            loadingIndicator.classList.remove('hidden');

            // Caminho para a coleção de eventos
            const eventsCollectionRef = collection(db, `artifacts/${appId}/public/data/events`);

            // Cria a query para buscar a coleção
            const eventsQuery = query(eventsCollectionRef);

            // onSnapshot para escuta em tempo real
            unsubscribeEvents = onSnapshot(eventsQuery, (snapshot) => {
                loadingIndicator.classList.add('hidden');

                const events = [];
                snapshot.forEach(doc => {
                    events.push({ id: doc.id, ...doc.data() });
                });

                // Se não há eventos no Firebase, usa os dados mockados
                if (events.length === 0) {
                    console.log('Nenhum evento encontrado no Firebase. Usando dados mockados para demonstração.');
                    events.push(...generateMockEvents());
                }

                // Armazena todos os eventos para filtragem
                allEvents = events;

                // Preenche opções de filtro
                populateFilterOptions(events);

                // Renderiza com base na visualização atual
                if (currentView === 'list') {
                    renderEvents(events);
                } else {
                    renderCalendar(currentDate, events);
                }

            }, (error) => {
                console.error("Erro ao carregar eventos:", error);
                loadingIndicator.classList.add('hidden');

                // Em caso de erro, usa dados mockados
                console.log('Erro ao conectar com Firebase. Usando dados mockados.');
                const mockEvents = generateMockEvents();
                allEvents = mockEvents;
                populateFilterOptions(mockEvents);

                if (currentView === 'list') {
                    renderEvents(mockEvents);
                } else {
                    renderCalendar(currentDate, mockEvents);
                }
            });
        }

        // Função de autenticação
        async function initializeAuthAndFirestore() {
            if (!firebaseConfig) {
                console.error("Configuração do Firebase não encontrada.");
                // Usa dados mockados mesmo sem Firebase
                const mockEvents = generateMockEvents();
                allEvents = mockEvents;
                populateFilterOptions(mockEvents);
                renderEvents(mockEvents);
                return;
            }

            try {
                // 1. Inicializa o App e serviços
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // 2. Realiza a autenticação
                await setPersistence(auth, browserLocalPersistence);
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // 3. Aguarda a mudança de estado de autenticação
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Usuário autenticado:", userId);
                        // Inicia a escuta dos dados APÓS a autenticação
                        subscribeToEvents();
                    } else {
                        userId = crypto.randomUUID();
                        console.log("Autenticação anônima ou falha na autenticação. Usando ID temporário.");
                        subscribeToEvents();
                    }
                });

            } catch (error) {
                console.error("Erro na inicialização do Firebase ou Autenticação:", error);
                showNotification('Erro de conexão com o servidor. Usando dados de demonstração.', 'error');

                // Usa dados mockados em caso de erro
                const mockEvents = generateMockEvents();
                allEvents = mockEvents;
                populateFilterOptions(mockEvents);
                renderEvents(mockEvents);
            }
        }

        // Verifica se há parâmetros de sucesso na URL
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const success = urlParams.get('success');
            const action = urlParams.get('action');

            if (success === 'true') {
                if (action === 'create') {
                    showNotification('Evento criado com sucesso!', 'success');
                } else if (action === 'update') {
                    showNotification('Evento atualizado com sucesso!', 'success');
                }

                // Limpa a URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // 4. Inicia o processo
        initializeAuthAndFirestore();
        checkUrlParams();

        // Configura eventos dos botões de visualização
        viewListBtn.addEventListener('click', () => toggleView('list'));
        viewCalendarBtn.addEventListener('click', () => toggleView('calendar'));

        // Configura eventos dos filtros
        secretariaFilter.addEventListener('change', applyFilters);
        categoriaFilter.addEventListener('change', applyFilters);
        prioridadeFilter.addEventListener('change', applyFilters);
        clearFiltersBtn.addEventListener('click', () => {
            secretariaFilter.value = '';
            categoriaFilter.value = '';
            prioridadeFilter.value = '';
            applyFilters();
        });

        // Configura eventos do calendário
        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate, allEvents);
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate, allEvents);
        });

        // Configura eventos do modal
        closeModalBtn.addEventListener('click', closeEventDetails);
        closeModalBtn2.addEventListener('click', closeEventDetails);
        editFromModalBtn.addEventListener('click', () => {
            if (currentEventId) {
                navigateToEditEvent(currentEventId);
            }
        });

        // Fecha modal ao clicar fora
        eventDetailsModal.addEventListener('click', (e) => {
            if (e.target === eventDetailsModal) {
                closeEventDetails();
            }
        });

        // Torna as funções globais para serem acessíveis pelos botões
        window.navigateToEditEvent = navigateToEditEvent;
        window.deleteEvent = deleteEvent;
        window.showEventDetails = showEventDetails;

        // Limpeza ao sair da página
        window.addEventListener('beforeunload', () => {
            if (unsubscribeEvents) {
                unsubscribeEvents();
            }
        });

    </script>
    <script src="https://cdn.tailwindcss.com"></script>
</body>